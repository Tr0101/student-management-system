{% extends "base.html" %}
{% block title %}üéì H·ªá th·ªëng h·ªó tr·ª£ ra quy·∫øt ƒë·ªãnh h·ªçc v·ª•{% endblock %}
{% block content %}

<style>
  .stat-card {
    border: none;
    border-radius: 16px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    padding: 20px;
    transition: all 0.3s ease;
  }
  .stat-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 18px rgba(0,0,0,0.08);
  }
  .stat-icon {
    font-size: 1.8rem;
    opacity: 0.8;
  }
  .card-header {
    background: linear-gradient(135deg, #007bff, #00c6ff);
    color: white;
    font-weight: 600;
    border-radius: 10px 10px 0 0;
  }
  .table thead th {
    background-color: #f8f9fa;
    position: sticky;
    top: 0;
    z-index: 1;
  }
  .table-hover tbody tr:hover {
    background-color: #f1f6ff;
  }
  h3.text-center {
    font-weight: 700;
    background: linear-gradient(90deg, #007bff, #00c6ff);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }
</style>

<div class="container mt-4">
  <h3 class="text-center mb-4">üéì B·∫£ng ƒëi·ªÅu khi·ªÉn qu·∫£n l√Ω sinh vi√™n</h3>

  <!-- Th·ªëng k√™ t·ªïng quan -->
  <div class="row text-center mb-4 g-3">
    <div class="col-md-4">
      <div class="stat-card bg-light border-start border-primary border-4">
        <div class="stat-icon text-primary mb-2"><i class="bi bi-people-fill"></i></div>
        <h6 class="text-muted">T·ªïng sinh vi√™n</h6>
        <h2 class="fw-bold text-primary">{{ total_students }}</h2>
      </div>
    </div>
    <div class="col-md-4">
      <div class="stat-card bg-light border-start border-success border-4">
        <div class="stat-icon text-success mb-2"><i class="bi bi-journal-text"></i></div>
        <h6 class="text-muted">T·ªïng m√¥n h·ªçc</h6>
        <h2 class="fw-bold text-success">{{ total_courses }}</h2>
      </div>
    </div>
    <div class="col-md-4">
      <div class="stat-card bg-light border-start border-info border-4">
        <div class="stat-icon text-info mb-2"><i class="bi bi-list-check"></i></div>
        <h6 class="text-muted">S·ªë l∆∞·ª£t ƒëƒÉng k√Ω h·ªçc</h6>
        <h2 class="fw-bold text-info">{{ total_enrolls }}</h2>
      </div>
    </div>
  </div>

  <!-- Bi·ªÉu ƒë·ªì v√† Top m√¥n h·ªçc -->
  <div class="row g-3">
    <div class="col-md-6">
      <div class="card h-100 shadow-sm">
        <div class="card-header">
          <i class="bi bi-bar-chart-fill me-2"></i>Ph√¢n b·ªë ƒëi·ªÉm sinh vi√™n
        </div>
        <div class="card-body">
          <canvas id="gradeChart" height="180"></canvas>
        </div>
      </div>
    </div>

    <div class="col-md-6">
      <div class="card h-100 shadow-sm">
        <div class="card-header">
          <i class="bi bi-trophy-fill me-2"></i>Top 5 m√¥n h·ªçc ƒë∆∞·ª£c ƒëƒÉng k√Ω nhi·ªÅu nh·∫•t
        </div>
        <div class="card-body p-0">
          <table class="table table-hover mb-0 align-middle">
            <thead>
              <tr>
                <th>M√¥n h·ªçc</th>
                <th class="text-center">S·ªë l∆∞·ª£t</th>
              </tr>
            </thead>
            <tbody>
              {% for c in top_courses %}
              <tr>
                <td>{{ c.name }}</td>
                <td class="text-center fw-semibold">{{ c.cnt }}</td>
              </tr>
              {% else %}
              <tr><td colspan="2" class="text-center text-muted py-3">Ch∆∞a c√≥ d·ªØ li·ªáu</td></tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- L·ªãch thi v√† Th·ªùi kh√≥a bi·ªÉu -->
  <div class="row g-3 mt-3">
    <div class="col-md-6">
      <div class="card shadow-sm">
        <div class="card-header">
          <i class="bi bi-calendar2-check-fill me-2"></i>L·ªãch thi s·∫Øp t·ªõi
        </div>
        <div class="card-body p-0">
          <table class="table table-hover mb-0 align-middle">
            <thead>
              <tr>
                <th>M√¥n h·ªçc</th>
                <th>Ng√†y thi</th>
                <th>Ph√≤ng</th>
                <th>Ghi ch√∫</th>
              </tr>
            </thead>
            <tbody>
              {% for exam in exams %}
              <tr>
                <td>{{ exam.course.name }}</td>
                <td>{{ exam.date.strftime('%d/%m/%Y') if exam.date else '-' }}</td>
                <td>{{ exam.room or '-' }}</td>
                <td>{{ exam.note or '' }}</td>
              </tr>
              {% else %}
              <tr><td colspan="4" class="text-center text-muted py-3">Ch∆∞a c√≥ l·ªãch thi</td></tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <div class="col-md-6">
      <div class="card shadow-sm">
        <div class="card-header">
          <i class="bi bi-clock-history me-2"></i>Th·ªùi kh√≥a bi·ªÉu hi·ªán t·∫°i
        </div>
        <div class="card-body p-0">
          <table class="table table-hover mb-0 align-middle">
            <thead>
              <tr>
                <th>Th·ª©</th>
                <th>Ca h·ªçc</th>
                <th>M√¥n h·ªçc</th>
                <th>Ph√≤ng</th>
              </tr>
            </thead>
            <tbody>
              {% for s in schedules %}
              <tr>
                <td>{{ s.weekday }}</td>
                <td>{{ s.time }}</td>
                <td>{{ s.course.name }}</td>
                <td>{{ s.room }}</td>
              </tr>
              {% else %}
              <tr><td colspan="4" class="text-center text-muted py-3">Ch∆∞a c√≥ th·ªùi kh√≥a bi·ªÉu</td></tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ChartJS -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const ctx = document.getElementById('gradeChart').getContext('2d');
const gradient = ctx.createLinearGradient(0, 0, 0, 300);
gradient.addColorStop(0, '#4facfe');
gradient.addColorStop(1, '#00f2fe');

new Chart(ctx, {
  type: 'bar',
  data: {
    labels: {{ labels|safe }},
    datasets: [{
      label: 'S·ªë sinh vi√™n',
      data: {{ values|safe }},
      backgroundColor: gradient,
      borderRadius: 6,
      borderWidth: 1
    }]
  },
  options: {
    responsive: true,
    plugins: {
      legend: { display: false },
      title: { display: true, text: 'Ph√¢n b·ªë ƒëi·ªÉm (theo thang 10)', color: '#333', font: { size: 15, weight: 'bold' } },
      tooltip: {
        backgroundColor: '#333',
        titleColor: '#fff',
        bodyColor: '#fff',
        borderWidth: 0,
        cornerRadius: 6
      }
    },
    scales: {
      y: { beginAtZero: true, ticks: { color: '#444' } },
      x: { ticks: { color: '#444' } }
    }
  }
});
</script>

{% endblock %}
