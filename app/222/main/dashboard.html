{% extends "base.html" %}
{% block title %}üéì H·ªá th·ªëng h·ªó tr·ª£ ra quy·∫øt ƒë·ªãnh h·ªçc v·ª•{% endblock %}
{% block content %}
<div class="container mt-4">

  <h3 class="text-center mb-4">üéì B·∫£ng ƒëi·ªÅu khi·ªÉn qu·∫£n l√Ω sinh vi√™n</h3>

  <!-- Th·ªëng k√™ t·ªïng quan -->
  <div class="row text-center mb-4">
    <div class="col-md-4 mb-3">
      <div class="border p-3 rounded shadow-sm">
        <h5 class="text-muted">T·ªïng sinh vi√™n</h5>
        <h3 class="text-primary fw-bold">{{ total_students }}</h3>
      </div>
    </div>
    <div class="col-md-4 mb-3">
      <div class="border p-3 rounded shadow-sm">
        <h5 class="text-muted">T·ªïng m√¥n h·ªçc</h5>
        <h3 class="text-success fw-bold">{{ total_courses }}</h3>
      </div>
    </div>
    <div class="col-md-4 mb-3">
      <div class="border p-3 rounded shadow-sm">
        <h5 class="text-muted">S·ªë l∆∞·ª£t ƒëƒÉng k√Ω h·ªçc</h5>
        <h3 class="text-info fw-bold">{{ total_enrolls }}</h3>
      </div>
    </div>
  </div>

  <!-- Ph√¢n b·ªë ƒëi·ªÉm v√† top m√¥n h·ªçc -->
  <div class="row">
    <div class="col-md-6 mb-4">
      <div class="card">
        <div class="card-header">
          üìä Ph√¢n b·ªë ƒëi·ªÉm sinh vi√™n
        </div>
        <div class="card-body">
          <canvas id="gradeChart" width="100%" height="70"></canvas>
        </div>
      </div>
    </div>

    <div class="col-md-6 mb-4">
      <div class="card">
        <div class="card-header">
          üèÜ Top 5 m√¥n h·ªçc ƒë∆∞·ª£c ƒëƒÉng k√Ω nhi·ªÅu nh·∫•t
        </div>
        <div class="card-body">
          <table class="table table-sm table-striped mb-0">
            <thead>
              <tr>
                <th>M√¥n h·ªçc</th>
                <th>S·ªë l∆∞·ª£t</th>
              </tr>
            </thead>
            <tbody>
              {% for c in top_courses %}
              <tr>
                <td>{{ c.name }}</td>
                <td>{{ c.cnt }}</td>
              </tr>
              {% else %}
              <tr><td colspan="2" class="text-center text-muted">Ch∆∞a c√≥ d·ªØ li·ªáu</td></tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- B·∫£ng L·ªãch thi & Th·ªùi kh√≥a bi·ªÉu -->
  <div class="row mt-4">
    <div class="col-md-6 mb-4">
      <div class="card">
        <div class="card-header">
          üìÖ L·ªãch thi s·∫Øp t·ªõi
        </div>
        <div class="card-body">
          <table class="table table-bordered table-sm">
            <thead>
              <tr>
                <th>M√¥n h·ªçc</th>
                <th>Ng√†y thi</th>
                <th>Ph√≤ng</th>
                <th>Ghi ch√∫</th>
              </tr>
            </thead>
            <tbody>
              {% for exam in exams %}
              <tr>
                <td>{{ exam.course.name }}</td>
                <td>{{ exam.date.strftime('%d/%m/%Y') if exam.date else '-' }}</td>
                <td>{{ exam.room or '-' }}</td>
                <td>{{ exam.note or '' }}</td>
              </tr>
              {% else %}
              <tr><td colspan="4" class="text-center text-muted">Ch∆∞a c√≥ l·ªãch thi</td></tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <div class="col-md-6 mb-4">
      <div class="card">
        <div class="card-header">
          üïí Th·ªùi kh√≥a bi·ªÉu hi·ªán t·∫°i
        </div>
        <div class="card-body">
          <table class="table table-bordered table-sm">
            <thead>
              <tr>
                <th>Th·ª©</th>
                <th>Ca h·ªçc</th>
                <th>M√¥n h·ªçc</th>
                <th>Ph√≤ng</th>
              </tr>
            </thead>
            <tbody>
              {% for s in schedules %}
              <tr>
                <td>{{ s.weekday }}</td>
                <td>{{ s.time }}</td>
                <td>{{ s.course.name }}</td>
                <td>{{ s.room }}</td>
              </tr>
              {% else %}
              <tr><td colspan="4" class="text-center text-muted">Ch∆∞a c√≥ th·ªùi kh√≥a bi·ªÉu</td></tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

</div>

<!-- Bi·ªÉu ƒë·ªì -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const ctx = document.getElementById('gradeChart').getContext('2d');
new Chart(ctx, {
  type: 'bar',
  data: {
    labels: {{ labels|safe }},
    datasets: [{
      label: 'S·ªë sinh vi√™n',
      data: {{ values|safe }},
      backgroundColor: ['#5B8FF9', '#61DDAA', '#65789B', '#F6BD16', '#7262fd']
    }]
  },
  options: {
    responsive: true,
    plugins: {
      legend: { display: false },
      title: { display: true, text: 'Ph√¢n b·ªë ƒëi·ªÉm (theo thang 10)' }
    },
    scales: {
      y: { beginAtZero: true }
    }
  }
});
</script>

{% endblock %}
